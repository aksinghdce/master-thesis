<!doctype html>
<html>
    <head>
        <meta charset="utf-8">
        <title>Master Thesis Prototype</title>
        <style>
            body {
                font-family: sans-serif;
                font-size: 1.0em;
                font-weight: 300;
            }
        </style>
    </head>
    <body>
        <h1>Proto</h1>
    <script src="js/jquery-2.2.3.min.js"></script>
    <script>
        // so far i saw three data structures (each max 2 levels deep: 1. list itself, 2. details)
        // - iCarWash: few list items, with up to 5 nodes containing car wash detials / data,
        // - Pracuj.pl: moderate length list; ad details downloaded on demand
        // - OLX: long lists, downloaded as pages of ca. 15 items. Item details downloaded with page.
        // This alone shows that making a library can be (well is) difficult. Problem here
        // is that the frontend client (the app) has to adapt do the server protocol (not vice versa).
        // IMO there is no point of making a library â†’ won't be any good
        // But I'll try!
        'use strict';
        var URL_ROOT    = 'http://localhost:8000/data/',
            I_CAR_WASH  = {'url_root': URL_ROOT + 'icarwash/'},
            PARCUJ      = {'url_root': URL_ROOT + 'pracuj/'},
            OLX         = {'url_root': URL_ROOT + 'olx/moto/'},
            NET_CACHE   = null;

// will download item list for iCarWash
        function getItems() {
            $.ajax({
                dataType: 'json',
                url: 'http://localhost:8000/data/icarwash/carwash-list',
                success: function (data, textStatus, jqXhr) {
                    NET_CACHE = data.content;

                    NET_CACHE.forEach(getDetails);
                }
            });
        }
// will download details for an item [iCarWash]
        function getDetails(item) {
            $.ajax({
                dataType: 'json',
                url: 'http://localhost:8000/data/icarwash/alarms/' + item.id,
                success: function (data, textStatus, jqXhr) {
                    item.alarms = data.content;
                }
            });
        }

        window.addEventListener('DOMContentLoaded', getItems);
    </script>
    </body>
</html>
